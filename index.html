<script>
document.addEventListener('DOMContentLoaded', function() {
    const CONSOMMATION_PAR_PERSONNE_L_PAR_JOUR = 100;
    const JOURS_PAR_AN = 365;
    const SEL_PAR_REGEN_KG = 0.34;
    const POIDS_KIT_8KG = 8; // 2 blocs de 4 kg
    const DURETE_RESIDUELLE = 60;

    function convertirEnMgL(valeur, unite) {
        if (unite === 'french') return valeur * 10;
        if (unite === 'german') return valeur * 17.8;
        return valeur;
    }

    function getVolumeParCycle(dureteMgL) {
        if (dureteMgL <= 108) return 1420;
        if (dureteMgL <= 115) return 1328;
        if (dureteMgL <= 123) return 1235;
        if (dureteMgL <= 132) return 1143;
        if (dureteMgL <= 143) return 1051;
        if (dureteMgL <= 156) return 958;
        if (dureteMgL <= 171) return 866;
        if (dureteMgL <= 191) return 773;
        if (dureteMgL <= 215) return 681;
        if (dureteMgL <= 230) return 635;
        if (dureteMgL <= 247) return 589;
        if (dureteMgL <= 266) return 543;
        if (dureteMgL <= 290) return 496;
        if (dureteMgL <= 318) return 450;
        if (dureteMgL <= 352) return 404;
        if (dureteMgL <= 394) return 358;
        if (dureteMgL <= 449) return 312;
        return 266;
    }

    document.getElementById('calculerSelCompact').addEventListener('click', function() {
        const dureteInput = parseFloat(document.getElementById('dureteEauCompact').value);
        const nbPersonnes = parseInt(document.getElementById('nbPersonnesCompact').value);
        const unite = document.getElementById('uniteDureteCompact').value;
        const resultat = document.getElementById('resultatSelCompact');

        if (isNaN(dureteInput) || isNaN(nbPersonnes)) {
            resultat.innerText = "Veuillez remplir correctement tous les champs.";
            return;
        }

        const dureteMgL = convertirEnMgL(dureteInput, unite);

        if (dureteMgL > 500) {
            resultat.innerText = "La dureté maximale autorisée est de 500 mg/L.";
            return;
        }

        const dureteTraitee = dureteMgL - DURETE_RESIDUELLE;
        if (dureteTraitee <= 0) {
            resultat.innerText = "La dureté brute doit être supérieure à 60 mg/L.";
            return;
        }

        const volumeParCycle = getVolumeParCycle(dureteTraitee);
        const consommationAnL = nbPersonnes * CONSOMMATION_PAR_PERSONNE_L_PAR_JOUR * JOURS_PAR_AN;
        const consommationAnM3 = consommationAnL / 1000;
        const nbRegenAn = consommationAnL / volumeParCycle;
        const selAnKg = nbRegenAn * SEL_PAR_REGEN_KG;
        const kitsBlocsAn = Math.ceil(selAnKg / POIDS_KIT_8KG);

        resultat.innerHTML = `
            <strong style="color: #0D7EBC;">Paramètres utilisés :</strong><br>
            - Volume d'eau estimé : 100 L/personne/jour (total : ${consommationAnM3.toFixed(1)} m³/an)<br>
            - Dureté résiduelle recommandée : 60 mg/L CaCO₃<br><br>
            <strong style="color: #0D7EBC;">Consommation de sel estimée :</strong><br><br>
            - Environ ${kitsBlocsAn} kits de 2 blocs de 4 kg par an (${selAnKg.toFixed(1)} kg)
        `;
    });
});
</script>
